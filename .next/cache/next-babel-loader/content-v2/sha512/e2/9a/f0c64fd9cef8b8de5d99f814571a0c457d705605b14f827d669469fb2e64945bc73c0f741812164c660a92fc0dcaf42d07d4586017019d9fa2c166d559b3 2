{"ast":null,"code":"import { UsingJoinColumnIsNotAllowedError } from \"typeorm\";\nimport S3 from \"../../lib/AWS\";\nexport default async function handle(req, res) {\n  console.log(\"f\", req.body);\n\n  if (req.method == POST) {\n    const response = await axios.get(`https://11k2bj0e8j.execute-api.us-east-2.amazonaws.com/default/getPresignedImageURL`);\n    console.log(\"Response: \", response); // * PUT request: upload file to S3\n    // follow youtube for https://www.youtube.com/watch?v=V45ymCXBpUM\n    // movie call to api backend.\n    // use the S3 client\n\n    const result = await fetch(response.data.uploadURL, {\n      method: \"PUT\",\n      headers: {\n        ContentType: \"image/jpeg, image/png, image/heic, mov/mp4\"\n      },\n      body: req.body.f[\"file\"]\n    });\n    console.log(\"Result: \", result);\n    const fileName = response.data.Key;\n    const params = {\n      Bucket: \"swell-clutch\",\n      Key: fileName,\n      Expires: 7776000\n    };\n    const signedURL = S3.getSignedUrl(\"getObject\", params);\n    console.log(\"url\", signedURL);\n    res.json(signedURL);\n  }\n}","map":{"version":3,"sources":["/Users/bengross/Desktop/Swell Clutch/Swell-Clutch/pages/api/getUploadImage.js"],"names":["UsingJoinColumnIsNotAllowedError","S3","handle","req","res","console","log","body","method","POST","response","axios","get","result","fetch","data","uploadURL","headers","ContentType","f","fileName","Key","params","Bucket","Expires","signedURL","getSignedUrl","json"],"mappings":"AAAA,SAASA,gCAAT,QAAiD,SAAjD;AACA,OAAOC,EAAP,MAAe,eAAf;AAEA,eAAe,eAAeC,MAAf,CAAsBC,GAAtB,EAA2BC,GAA3B,EAAgC;AAC7CC,EAAAA,OAAO,CAACC,GAAR,CAAY,GAAZ,EAAiBH,GAAG,CAACI,IAArB;;AACA,MAAIJ,GAAG,CAACK,MAAJ,IAAcC,IAAlB,EAAwB;AACtB,UAAMC,QAAQ,GAAG,MAAMC,KAAK,CAACC,GAAN,CACpB,qFADoB,CAAvB;AAIAP,IAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ,EAA0BI,QAA1B,EALsB,CAOtB;AAEA;AACA;AACA;;AACA,UAAMG,MAAM,GAAG,MAAMC,KAAK,CAACJ,QAAQ,CAACK,IAAT,CAAcC,SAAf,EAA0B;AAClDR,MAAAA,MAAM,EAAE,KAD0C;AAElDS,MAAAA,OAAO,EAAE;AACPC,QAAAA,WAAW,EAAE;AADN,OAFyC;AAKlDX,MAAAA,IAAI,EAAEJ,GAAG,CAACI,IAAJ,CAASY,CAAT,CAAW,MAAX;AAL4C,KAA1B,CAA1B;AAOAd,IAAAA,OAAO,CAACC,GAAR,CAAY,UAAZ,EAAwBO,MAAxB;AAEA,UAAMO,QAAQ,GAAGV,QAAQ,CAACK,IAAT,CAAcM,GAA/B;AAEA,UAAMC,MAAM,GAAG;AACbC,MAAAA,MAAM,EAAE,cADK;AAEbF,MAAAA,GAAG,EAAED,QAFQ;AAGbI,MAAAA,OAAO,EAAE;AAHI,KAAf;AAMA,UAAMC,SAAS,GAAGxB,EAAE,CAACyB,YAAH,CAAgB,WAAhB,EAA6BJ,MAA7B,CAAlB;AAEAjB,IAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAmBmB,SAAnB;AACArB,IAAAA,GAAG,CAACuB,IAAJ,CAASF,SAAT;AACD;AACF","sourcesContent":["import { UsingJoinColumnIsNotAllowedError } from \"typeorm\";\nimport S3 from \"../../lib/AWS\";\n\nexport default async function handle(req, res) {\n  console.log(\"f\", req.body);\n  if (req.method == POST) {\n    const response = await axios.get(\n      `https://11k2bj0e8j.execute-api.us-east-2.amazonaws.com/default/getPresignedImageURL`\n    );\n\n    console.log(\"Response: \", response);\n\n    // * PUT request: upload file to S3\n\n    // follow youtube for https://www.youtube.com/watch?v=V45ymCXBpUM\n    // movie call to api backend.\n    // use the S3 client\n    const result = await fetch(response.data.uploadURL, {\n      method: \"PUT\",\n      headers: {\n        ContentType: \"image/jpeg, image/png, image/heic, mov/mp4\",\n      },\n      body: req.body.f[\"file\"],\n    });\n    console.log(\"Result: \", result);\n\n    const fileName = response.data.Key;\n\n    const params = {\n      Bucket: \"swell-clutch\",\n      Key: fileName,\n      Expires: 7776000,\n    };\n\n    const signedURL = S3.getSignedUrl(\"getObject\", params);\n\n    console.log(\"url\", signedURL);\n    res.json(signedURL);\n  }\n}\n"]},"metadata":{},"sourceType":"module"}